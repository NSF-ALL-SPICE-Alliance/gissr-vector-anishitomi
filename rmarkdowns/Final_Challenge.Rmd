---
title: "Final Challenge Instructions"
author: "Catherine Brockway"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: flatly
    toc: TRUE
    toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("vembedr")
```

<img src="`r here::here('Images/ALL-SPICE.png')`" width="240" /> <img src="`r here::here('Images/3_CIFAL.png')`" width="200" />

 

<img src="`r here::here('Images/E-WEB-Goal-03.png')`" width="100" /> <img src="`r here::here('Images/E-WEB-Goal-11.png')`" width="100" /> <img src="`r here::here('Images/E-WEB-Goal-16.png')`" width="100" />

# Project Location
## Island of Oahu

# Introduction and Project Details
Aloha, my name is Andrew Nishitomi. Currently, I am a student at Chaminade University working towards achieving my Bachelor's degree in Criminal Justice/Criminology and Data Science. The scope of this project is focused on the island of Oahu. In recent years, prisons have ran into the reoccurring issue of overcrowding with inmates and have struggled to house inmates that are born in raised in the State. As a subsequent consequence to the precedent issue at hand, new inmates have had to be send to other prisons within the United States to maintain the current population of state prisons and correctional facilities. This unprecedented issue has inspired me to investigate into whether or not the island of Oahu would be able to create a new facillity to house more inmates. However, I will take into consideration the location of hospitals and courthouses. I will also consider the population density of the Island of Oahu as well. 



# Code
### Loading in Libraries
```{r}
library(tidyverse)
library(leaflet)
library(osmdata)
library(leaflet)
library(rinat)
library(sf)
library(tmap)
library(plotly)
```

#### Looking at Available Features in OSM data
```{r}
available_features()
```

#### Looking at features from the `available_features()` list and use the `available_tags()` function to list all the associated tags.
```{r}
available_tags("amenity")
```

#### Getting Boundary Box of the Island of Oahu
```{r}
boundary_box <- getbb("Oahu")
boundary_box
```

#### Use the previously defined bounding box to create the overpass query.
```{r}
boundary_box %>% 
  opq()
```

### Retreiving OSM Data

Retrieve prison, courthouse, and hospital data for your new bounding box
```{r}
prisons <- boundary_box %>%
  opq() %>%
  add_osm_feature(key = "amenity", value = "prison") %>%
  osmdata_sf()

hospitals <- boundary_box %>%
  opq() %>%
  add_osm_feature(key = "amenity", value = "hospital") %>%
  osmdata_sf()

courthouse <- boundary_box %>%
  opq() %>%
  add_osm_feature(key = "amenity", value = "courthouse") %>%
  osmdata_sf()
```

Retreiving streets, small streets, and coastline data for the map
```{r}
# retrieving data of streets on Oahu
streets <- boundary_box %>%
  opq() %>%
  add_osm_feature("highway", c("motorway", "primary", "secondary", "tertiary")) %>%
  osmdata_sf()

# retrieving data of small streets on Oahu
small_streets <- boundary_box %>%
  opq() %>%
  add_osm_feature(key = "highway", value = c( "living_street", "unclassified", "service", "footway")) %>%
  osmdata_sf()

# retrieving data of coastline on Oahu
coastline <- boundary_box %>%
  opq() %>%
  add_osm_feature(key = "natural", value = "coastline") %>%
  osmdata_sf()
```

# Create Maps
#### Create a map with locations of facillities
```{r}
# visualising all retrieved features over each other to form a map of Oahu
ggplot() +
  geom_sf(data = streets$osm_lines, inherit.aes = FALSE, color = "#ffbe7f", size = .4, alpha = .8) +
  geom_sf(data = small_streets$osm_lines, inherit.aes = FALSE, color = "#a6a6a6", size = .2, alpha = .8) +
  geom_sf(data = coastline$osm_lines, inherit.aes = FALSE, color = "black", size = .8, alpha = .5) +
  geom_sf(data = prisons$osm_polygons, inherit.aes = FALSE, colour = "red", fill = "red", alpha = .5, size = 10) +
  geom_sf(data = hospitals$osm_polygons, inherit.aes = FALSE, colour = "green", fill = "green", alpha = .5, size = 10) +
  geom_sf(data = hospitals$osm_polygons, inherit.aes = FALSE, colour = "blue", fill = "blue", alpha = .5, size = 10) +
  coord_sf(xlim = c(-158.28058, -157.64863), ylim = c(21.25482, 21.71201), expand = TRUE) +
  geom_sf_text(data = prisons$osm_polygons, aes(label = name), size = 1.5, hjust = 0) +
  geom_sf_text(data = hospitals$osm_polygons, aes(label = name), size = 1.5, hjust = 0) +
  geom_sf_text(data = courthouse$osm_polygons, aes(label = name), size = 1.5, hjust = 0) +
  theme_bw() +
  labs(
    title = "Distance of Prisons to Hospitals and Courhouses on Oahu",
    x = "Longitude",
    y = "Latitude"
  )
```



#### Interpretation of the Map
Here we can see the names of the different Hospitals, Courthouses, and Prisons. However, it is difficult to pin point where exactly are these locations.In doing so, lets create a map without the location names and see their locations using scatter points. That way we can look at the distancs that would need to be traveled to these locations. 

```{r, include=FALSE}
# Plot the map
ggplot() +
  # Base map: street lines or coastlines (optional)
  geom_sf(data = streets$osm_lines, inherit.aes = FALSE, color = "#ffbe7f", size = 0.5) +
  geom_sf(data = coastline$osm_lines, inherit.aes = FALSE, color = "black", size = 0.8) +
  
  # Plot prisons as red points
  geom_sf(data = prisons$osm_polygons, color = "red", size = 25, shape = 21, fill = "red") +
  
  # Plot hospitals as green points
  geom_sf(data = hospitals$osm_polygons, color = "green", size = 25, shape = 21, fill = "green") +
  
  # Plot courthouses as blue points
  geom_sf(data = courthouse$osm_polygons, color = "blue", size = 25, shape = 21, fill = "blue") +
  
  # Optionally, add labels next to the points (name of the location)
  #geom_sf_text(data = prisons$osm_polygons, aes(label = name), color = "red", size = 3, nudge_y = 0.005) +
  #geom_sf_text(data = hospitals$osm_polygons, aes(label = name), color = "green", size = 3, nudge_y = 0.005) +
  #geom_sf_text(data = courthouse$osm_polygons, aes(label = name), color = "blue", size = 3, nudge_y = 0.005) +
  
  # Coordinate limits and base theme
  coord_sf(xlim = c(-158.3, -157.6), ylim = c(21.1, 21.8), expand = FALSE) +
  theme_minimal() +
  
  # Labels and title
  labs(
    title = "Locations of Prisons, Hospitals, and Courthouses on Oahu",
    x = "Longitude",
    y = "Latitude"
  )

```

#### Creating a map without location names and have them appear as scatter points. 
```{r}
# Assuming `prisons`, `hospitals`, and `courthouses` are your sf objects with valid geometries.

# Extract coordinates for prisons, hospitals, and courthouses
prison_coords <- st_coordinates(prisons$osm_polygons)
hospital_coords <- st_coordinates(hospitals$osm_polygons)
courthouse_coords <- st_coordinates(courthouse$osm_polygons)

# Combine data into a single data frame for plotting
plot_data <- data.frame(
  lon = c(prison_coords[, 1], hospital_coords[, 1], courthouse_coords[, 1]),
  lat = c(prison_coords[, 2], hospital_coords[, 2], courthouse_coords[, 2]),
  type = factor(c(rep("Prison", nrow(prison_coords)), 
                  rep("Hospital", nrow(hospital_coords)), 
                  rep("Courthouse", nrow(courthouse_coords))))
)

# Plot the map with scatter points
ggplot() +
  # Base map: street lines or coastlines (optional)
  geom_sf(data = streets$osm_lines, inherit.aes = FALSE, color = "#ffbe7f", size = 0.5) +
  geom_sf(data = small_streets$osm_lines, inherit.aes = FALSE, color = "#a6a6a6", size = .2, alpha = .8) +
  geom_sf(data = coastline$osm_lines, inherit.aes = FALSE, color = "black", size = 0.8) +
  
  # Plot points for each type
  geom_point(data = plot_data, aes(x = lon, y = lat, color = type), size = 1) +
  
  # Set coordinate limits and base theme
  coord_sf(xlim = c(-158.3, -157.6), ylim = c(21.25, 21.75), expand = FALSE) +
  theme_minimal() +
  
  # Labels and title
  labs(
    title = "Locations of Prisons, Hospitals, and Courthouses on Oahu",
    x = "Longitude",
    y = "Latitude",
    color = "Type"
  ) +
  scale_color_manual(values = c("Prison" = "red", "Hospital" = "green", "Courthouse" = "blue"))

```

### Interpretation
From this map, we can generally see the distances from prisons, courthouses, and hospitals. From this image of the map, we can see that there are generally a hospital that is closer to the prisons/correction facilities. One thing to note is that these points are not specific to the name of the courthouse. Some courthouses may not be for federal criminal cases. Where we see a courthouse located Southeast is where there is a federal courthouse.The Courthouses located West/Southwest of the island are more like State Court buildings. So that is one thing to note. However, we do see that the general distance from prisons to hospitals are significantly close. From this map, we can also assume that there are buildings closely associated with the small streets as shown on the map as well. The data came from the OSM data and for the next map I decided to use the exact locations of all facilities on Oahu by searching all of their data points. 


### Produce a leaflet map
```{r}
library(leaflet)

# Data frame with hospitals, courthouses, and prisons on Oahu
locations_oahu <- data.frame(
  name = c("The Queen's Medical Center", "Kaiser Permanente Moanalua Medical Center", "Pali Momi Medical Center",
           "Straub Medical Center", "Kapi'olani Medical Center", "Adventist Health Castle",
           "Kuakini Medical Center", "Wahiawa General Hospital", "Tripler Army Medical Center",
           "First Circuit Court", "Hawaii Supreme Court", "Kapolei Court Complex",
           "Ewa District Court", "Wahiawa District Court", "Waianae District Court",
           "Kaneohe District Court", "Oahu Community Correctional Center", "Halawa Correctional Facility",
           "Women's Community Correctional Center", "Waiawa Correctional Facility"),
  type = c(rep("Hospital", 9), rep("Courthouse", 7), rep("Prison", 4)),
  lat = c(21.3099, 21.3754, 21.3854, 21.3045, 21.2956, 21.3889, 21.3210, 21.5016, 21.3606,
          21.3073, 21.3066, 21.3355, 21.3386, 21.5022, 21.4443, 21.4036,
          21.3242, 21.3853, 21.3985, 21.4448),
  lng = c(-157.8545, -157.8870, -157.9458, -157.8511, -157.8419, -157.7896, -157.8567, -158.0190, -157.8902,
          -157.8581, -157.8609, -158.0482, -158.0365, -158.0189, -158.1924, -157.7995,
          -157.8687, -157.9076, -157.7861, -157.9786)
)

# Create Leaflet map centered on Oahu
leaflet(data = locations_oahu) %>%
  addTiles() %>%
  setView(lng = -158.0001, lat = 21.4389, zoom = 11) %>%  # Center map on Oahu
  addCircleMarkers(~lng, ~lat,
                   color = ~ifelse(type == "Prison", "red",
                                   ifelse(type == "Courthouse", "blue", "green")),
                   radius = 6,
                   label = ~paste(name, type),
                   popup = ~paste("Location:", name, "<br>", "Type:", type))


```

### Interpretation of Leaflet Map
Being able to combine our idea from our previous map allows us to have the capability to access not only the distance from each Hospital, Courthouse, and Prison/Jail, but we have the ability to see if there is any available land to build a new prison. Based on our map above, we can see that it would be difficult to build a new prison based on the visual above. The space is very limited and restricted. Another thing to note is that we were able to add the names to the individual points of the locations as well. 

The data came from looking up all the possible locations for prisons, hospitals, and courthouses on the Island of Oahu and retrieving each individual longitude and latitude point for the prospective locations. This would allow for a more accurate representation of all the hospitals and courthouses in comparison to the two maps that were previously made. 


# Recommendations for future work

For the future, exploring the population density is something that can be incorporated into this project. The island of Oahu is essentially building on top of what is already built and will soon run out of space on the island to add facilities to withstand the population growth over time. With that being said, crime is also bound to increase as well. This idea is clearly through subjective thinking and as a resident that currently lives on Oahu as well. Here are some questions that can be answered in the future. So will the state continue to send inmates to the other states? Or, will they find a way to build a new facility?

